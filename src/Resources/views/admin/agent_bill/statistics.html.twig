{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content_title %}代理账单统计{% endblock %}

{% block main %}
    <div class="row">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">总账单数</h5>
                    <h2 class="text-primary">{{ statistics.totalBills|default(0) }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">待审核</h5>
                    <h2 class="text-warning">{{ statistics.pendingBills|default(0) }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">已审核</h5>
                    <h2 class="text-success">{{ statistics.approvedBills|default(0) }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">总金额</h5>
                    <h2 class="text-info">¥{{ statistics.totalAmount|default(0)|number_format(2) }}</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="card-title">按月份统计</h5>
        </div>
        <div class="card-body">
            {% if statistics.monthlyStats is defined and statistics.monthlyStats %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>月份</th>
                                <th>账单数量</th>
                                <th>总金额</th>
                                <th>平均金额</th>
                                <th>状态分布</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for month, data in statistics.monthlyStats %}
                                <tr>
                                    <td>{{ month }}</td>
                                    <td>{{ data.count }}</td>
                                    <td>¥{{ data.totalAmount|number_format(2) }}</td>
                                    <td>¥{{ data.averageAmount|number_format(2) }}</td>
                                    <td>
                                        <span class="badge badge-warning">待审核 {{ data.pending }}</span>
                                        <span class="badge badge-success">已审核 {{ data.approved }}</span>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted">暂无统计数据</p>
            {% endif %}
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="card-title">按代理等级统计</h5>
        </div>
        <div class="card-body">
            {% if statistics.levelStats is defined and statistics.levelStats %}
                <div class="row">
                    {% for level, data in statistics.levelStats %}
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h6 class="card-title">{{ level }}</h6>
                                    <p>账单数量: <strong>{{ data.count }}</strong></p>
                                    <p>总金额: <strong>¥{{ data.totalAmount|number_format(2) }}</strong></p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted">暂无等级统计数据</p>
            {% endif %}
        </div>
    </div>

    <div class="mt-3">
        <a href="{{ ea_url().setAction('index') }}" class="btn btn-secondary">
            <i class="fa fa-arrow-left"></i> 返回账单列表
        </a>
        <button onclick="window.print()" class="btn btn-info ml-2">
            <i class="fa fa-print"></i> 打印报告
        </button>
    </div>
{% endblock %}